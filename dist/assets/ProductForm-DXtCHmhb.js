import{h as k,a as w,r as S,j as e,c as d,B as p}from"./index-BLFxWsoH.js";import{u as O,o as P,c as T,a as i,b as g}from"./index.esm-7R15jc3W.js";const $=T({name:i().required(),category:i().required(),price:g().min(0).required(),stock:g().min(0).required(),unitType:i().oneOf(["kg","pcs"]).optional(),image:i().url().nullable().optional()});function A(){const{id:a}=k(),h=w(),{register:t,handleSubmit:j,reset:m,setValue:y,watch:q,formState:{errors:s,isSubmitting:u}}=O({resolver:P($)});S.useEffect(()=>{(async()=>{if(a)try{const r=(await d.get(`/products/${a}`)).data;m(r);const l=Array.isArray(r.unitOptions)?r.unitOptions.map(n=>`${n.label} | ${n.multiplier}`).join(`
`):"";y("unitOptionsText",l)}catch{p.error("Failed to load product")}})()},[a,m]);const N=async c=>{try{const o=(c.unitOptionsText||"").trim();let r;o&&(r=o.split(/\r?\n/).map(n=>{const[f,v]=n.split("|"),x=String(f||"").trim(),b=Number(String(v||"").trim()||"1");return x?{label:x,multiplier:isNaN(b)?1:b}:null}).filter(Boolean));const l={...c,unitOptions:r};delete l.unitOptionsText,a?await d.put(`/products/${a}`,l):await d.post("/products",l),p.success("Saved"),h("/products")}catch{p.error("Save failed")}};return e.jsxs("div",{className:"max-w-xl",children:[e.jsxs("h1",{className:"text-2xl font-semibold mb-4",children:[a?"Edit":"Add"," Product"]}),e.jsxs("form",{onSubmit:j(N),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"Name"}),e.jsx("input",{className:"w-full border rounded px-3 py-2 bg-transparent",...t("name")}),s.name&&e.jsx("p",{className:"text-sm text-brand-brown",children:s.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"Category"}),e.jsx("input",{className:"w-full border rounded px-3 py-2 bg-transparent",...t("category")}),s.category&&e.jsx("p",{className:"text-sm text-brand-brown",children:s.category.message})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"Price"}),e.jsx("input",{type:"number",step:"0.01",className:"w-full border rounded px-3 py-2 bg-transparent",...t("price")}),s.price&&e.jsx("p",{className:"text-sm text-brand-brown",children:s.price.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"Stock"}),e.jsx("input",{type:"number",className:"w-full border rounded px-3 py-2 bg-transparent",...t("stock")}),s.stock&&e.jsx("p",{className:"text-sm text-brand-brown",children:s.stock.message})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"Unit Type"}),e.jsxs("select",{className:"w-full border rounded px-3 py-2 bg-transparent",...t("unitType"),defaultValue:"kg",children:[e.jsx("option",{value:"kg",children:"Weight (g/kg)"}),e.jsx("option",{value:"pcs",children:"Pieces"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"Custom Unit Options"}),e.jsx("textarea",{rows:"3",className:"w-full border rounded px-3 py-2 bg-transparent",placeholder:"e.g.\\n250 g | 0.25\\n1 kg | 1\\n2 kg | 2",...t("unitOptionsText")}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Format: one per line as “label | multiplier”. Leave empty to use defaults by unit type."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"Image URL"}),e.jsx("input",{className:"w-full border rounded px-3 py-2 bg-transparent",...t("image")})]}),e.jsx("button",{disabled:u,className:"px-4 py-2 bg-brand-steel text-white rounded",children:u?"...":"Save"})]})]})}export{A as default};
