import{r,e as S,u as w,d as D,j as t,L as f,f as E,g as C,c as g,B as l}from"./index-BLFxWsoH.js";import{P as L}from"./ProductCard-SdD7wiL6.js";function A(){const[h,j]=r.useState([]),[d,b]=r.useState(""),[o,y]=r.useState(""),[N,u]=r.useState(!1),[i]=S(),m=w(),{user:a}=D(e=>e.auth),p=async()=>{u(!0);try{const s=(await g.get("/products",{params:{q:d,category:o}})).data||[];let x={};try{x=JSON.parse(localStorage.getItem("saleOverrides")||"{}")||{}}catch{}const v=s.map(c=>{const n=x[c.name];return n!=null&&!isNaN(+n)?{...c,originalPrice:c.price,price:+n}:c});j(v)}catch{l.error("Failed to load products")}finally{u(!1)}};r.useEffect(()=>{const e=i.get("q")||"",s=i.get("category")||"";e!==d&&b(e),s!==o&&y(s)},[i]),r.useEffect(()=>{p()},[d,o]);const P=async e=>{if(confirm("Delete this product?"))try{await g.delete(`/products/${e}`),l.success("Deleted"),p()}catch{l.error("Delete failed")}};return t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h1",{className:"text-2xl font-semibold",children:"Products"}),(a==null?void 0:a.role)==="admin"&&t.jsx(f,{to:"/products/new",className:"px-3 py-2 bg-[#6F4E37] text-white rounded",children:"Add Product"})]}),N?t.jsx("div",{children:"Loading..."}):t.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:h.map(e=>t.jsxs("div",{className:"relative",children:[t.jsx(L,{product:e,onAdd:s=>m(C(s)),onDec:s=>m(E(s))}),(a==null?void 0:a.role)==="admin"&&t.jsxs("div",{className:"absolute top-2 right-2 flex gap-2",children:[t.jsx(f,{to:`/products/${e.id}`,className:"px-2 py-1 text-xs bg-brand-sand text-black rounded",children:"Edit"}),t.jsx("button",{onClick:()=>P(e.id),className:"px-2 py-1 text-xs bg-brand-brown text-white rounded",children:"Del"})]})]},e.id))})]})}export{A as default};
